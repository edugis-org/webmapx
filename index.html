<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebMapX</title>

    <!-- Shoelace themes - both loaded, class on html determines active -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.14.0/cdn/themes/light.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.14.0/cdn/themes/dark.css" />

    <link rel="stylesheet" href="./src/theme/webmapx-style-core.css">

    <link rel="stylesheet" href="./app.css">
    <script type="module" src="./src/app.js"></script>
    <style>
        /* Hide tools by default */
        #layer-tool, #settings-tool, #measure-tool { display: none; height: 100%; }
    </style>
</head>
<body>
    <div class="table">
        <div>
            <webmapx-map id="map-container" adapter="maplibre" src="config/demo.json">                
                <webmapx-layout>
                    <webmapx-zoom-level slot="top-center"></webmapx-zoom-level>
                    <webmapx-zoom-level slot="top-right"></webmapx-zoom-level>
                    <webmapx-zoom-level slot="middle-right"></webmapx-zoom-level>
                    <webmapx-zoom-level slot="bottom-right"></webmapx-zoom-level>
                    
                    <webmapx-tool-template slot="bottom-left"></webmapx-tool-template>
                    <webmapx-zoom-level slot="bottom-left"></webmapx-zoom-level>
                    
                    <!-- Top Left: Toolbar + Panel -->
                    <webmapx-control-group slot="bottom-left" orientation="horizontal" panel-position="before" alignment="start">
                        <webmapx-toolbar id="main-toolbar">
                            <sl-button name="layers" size="medium" circle>
                                <sl-icon name="layers" label="Layers"></sl-icon>
                            </sl-button>
                            <sl-button name="measure" size="medium" circle>
                                <sl-icon name="rulers" label="Measure"></sl-icon>
                            </sl-button>
                            <sl-button name="settings" size="medium" circle>
                                <sl-icon name="gear" label="Settings"></sl-icon>
                            </sl-button>
                        </webmapx-toolbar>

                        <webmapx-tool-panel id="tool-panel" label="Tools">
                            <webmapx-layer-tree id="layer-tool"></webmapx-layer-tree>
                            <webmapx-measure-tool id="measure-tool"></webmapx-measure-tool>
                            <webmapx-settings id="settings-tool"></webmapx-settings>
                        </webmapx-tool-panel>
                    </webmapx-control-group>

                    <webmapx-coordinates-tool slot="bottom-center"></webmapx-coordinates-tool>
                    <webmapx-inset-map slot="top-left" zoom-offset="-4"></webmapx-inset-map>
                    <webmapx-spinner slot="middle-center"></webmapx-spinner>
                </webmapx-layout>

            </webmapx-map>
        </div>
        
        <!-- External Tools Column -->
        <div>
            <h3>External Tools</h3>
            <p>This zoom control is outside the map but linked to it.</p>
            <webmapx-zoom-level map="#map-container"></webmapx-zoom-level>
            <br/>
            <webmapx-inset-map zoom-offset="-5"></webmapx-inset-map>
            <br/>
            <webmapx-spinner></webmapx-spinner>
        </div>
    </div>

    <script>
        const toolbar = document.getElementById('main-toolbar');
        const panel = document.getElementById('tool-panel');
        const layerTool = document.getElementById('layer-tool');
        const measureTool = document.getElementById('measure-tool');
        const settingsTool = document.getElementById('settings-tool');

        // Listen for tool selection
        toolbar.addEventListener('webmapx-tool-select', (e) => {
            const toolId = e.detail.toolId;

            if (!toolId) {
                panel.active = false;
                measureTool.active = false;
                return;
            }

            panel.active = true;

            // Reset views
            layerTool.style.display = 'none';
            measureTool.style.display = 'none';
            measureTool.active = false;
            settingsTool.style.display = 'none';

            if (toolId === 'layers') {
                layerTool.style.display = 'block';
                panel.label = 'Layers';
            } else if (toolId === 'measure') {
                measureTool.style.display = 'block';
                measureTool.active = true;
                panel.label = 'Measure';
            } else if (toolId === 'settings') {
                settingsTool.style.display = 'block';
                panel.label = 'Settings';
            }
        });

        // Listen for panel close event (from the X button inside the component)
        panel.addEventListener('webmapx-panel-close', () => {
             // Deactivate toolbar buttons manually to sync state
             const buttons = toolbar.querySelectorAll('sl-button');
             buttons.forEach(b => {
                 b.removeAttribute('active');
                 b.setAttribute('variant', 'default');
             });
             // Deactivate measure tool
             measureTool.active = false;
        });

        // Listen for layer toggles
        layerTool.addEventListener('layer-toggle', (e) => {
            console.log('Layer toggled:', e.detail);
        });
    </script>
</body>
</html>